<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>„Åä‰∏ñË©±ÂêàÊà¶ - „Å§„Åæ„Çâ„Å™„ÅÑ„Åä‰∏ñË©±„Ç≤„Éº„É†</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: "Yu Gothic", "Meiryo", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5fb;
      color: #222;
      font-size: 15px;
      line-height: 1.6;
      font-weight: 500;
    }
    h1, h2, h3 {
      margin: 0 0 8px;
      font-weight: 700;
    }
    button {
      font-family: inherit;
    }

    .app-header {
      padding: 12px 16px;
      background: #ffffff;
      border-bottom: 1px solid #ddd;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .app-header-left {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .app-header-title {
      font-size: 19px;
      font-weight: 800;
    }
    .app-header-sub {
      font-size: 12px;
      color: #555;
      font-weight: 600;
    }
    .app-header-right {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
      color: #444;
      font-weight: 600;
    }
    .heart-box {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      border-radius: 999px;
      background: #ffe4ef;
      border: 1px solid #ffb3cb;
      font-weight: 700;
    }

    #app {
      max-width: 900px;
      margin: 0 auto;
      padding: 16px;
    }

    .screen {
      display: none;
      background: #ffffff;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      margin-top: 12px;
    }
    .screen.active {
      display: block;
    }

    /* Â§ß„Åç„Å™„Ç≠„É£„É©Ë°®Á§∫ */
    .char-visual {
      margin: 12px auto 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }
    .char-visual-inner {
      width: 170px;
      height: 170px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 20%, #fff, #ffd9ec);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.12);
      overflow: hidden;
      transform-origin: center center;
      /* „Åµ„Å†„Çì„ÅØ„ÇÜ„Çâ„ÇÜ„Çâ„Ç¢„Éã„É° */
      animation: char-sway 2.2s ease-in-out infinite;
    }
    .char-visual-inner img {
      width: 80%;
      height: 80%;
      object-fit: contain;
      pointer-events: none;
    }
    .char-visual-inner.spin-kuru {
      /* „ÇÜ„Çâ„ÇÜ„ÇâÔºã‰∏ÄÁû¨„Åè„Çã„Çä„Çì */
      animation: char-sway 2.2s ease-in-out infinite, char-spin 0.6s ease-out;
    }
    .char-visual-name {
      font-size: 15px;
      font-weight: 800;
    }
    .char-visual-tag {
      font-size: 12px;
      color: #555;
      font-weight: 600;
    }
    .hidden {
      display: none;
    }

    /* „Ç≠„É£„É©„ÅÆ„ÇÜ„Çâ„ÇÜ„ÇâÔºÜ„Åè„Çã„Çä„Çì„Ç¢„Éã„É° */
    @keyframes char-sway {
      0%   { transform: translateY(0); }
      50%  { transform: translateY(-6px); }
      100% { transform: translateY(0); }
    }
    @keyframes char-spin {
      0%   { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .char-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 12px;
      margin-top: 8px;
    }

    .char-card {
      border-radius: 16px;
      padding: 10px;
      background: #fafafa;
      border: 2px solid transparent;
      cursor: pointer;
      display: flex;
      gap: 10px;
      align-items: center;
      transition: transform 0.1s ease, box-shadow 0.1s ease, border-color 0.1s ease;
    }
    .char-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    .char-card.selected {
      border-color: #ff7aa2;
      box-shadow: 0 0 0 2px rgba(255,122,162,0.15);
      background: #fff7fb;
    }
    .char-icon-small {
      width: 76px;
      height: 76px;
      border-radius: 50%;
      background: #eee;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      flex-shrink: 0;
    }
    .char-icon-small img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .char-info-title {
      font-weight: 800;
      margin-bottom: 4px;
      font-size: 15px;
    }
    .char-info-desc {
      font-size: 13px;
      color: #444;
      margin-bottom: 2px;
      font-weight: 500;
    }
    .char-info-tag {
      font-size: 12px;
      color: #666;
      font-weight: 600;
    }

    .bubble {
      position: relative;
      display: inline-block;
      max-width: 100%;
      padding: 8px 12px;
      border-radius: 16px;
      background: #fff2f6;
      font-size: 13px;
      margin: 8px 0 12px;
      font-weight: 600;
      color: #444;
    }
    .bubble::after {
      content: "";
      position: absolute;
      left: 16px;
      bottom: -6px;
      border-width: 6px;
      border-style: solid;
      border-color: #fff2f6 transparent transparent transparent;
    }

    .scene-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 4px;
    }
    .scene-step {
      font-size: 12px;
      color: #666;
      font-weight: 600;
    }
    .scene-title {
      font-size: 17px;
      font-weight: 800;
    }

    .scene-desc {
      font-size: 13px;
      color: #444;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .choice-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 10px;
    }
    .choice-item {
      border-radius: 14px;
      padding: 10px 12px;
      border: 2px solid #ddd;
      background: #fafafa;
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      transition: background 0.1s ease, border-color 0.1s ease, transform 0.05s ease;
    }
    .choice-item:hover {
      background: #fff;
      border-color: #ffb3cb;
      transform: translateY(-1px);
    }
    .choice-item input[type="radio"] {
      margin-top: 4px;
    }
    .choice-icon-circle {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: #fff;
      border: 1px solid #ddd;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
    }
    .choice-main {
      flex: 1;
    }
    .choice-label {
      font-size: 15px;
      font-weight: 800;
      color: #222;
    }
    .choice-tag {
      font-size: 12px;
      color: #666;
      margin-top: 2px;
      font-weight: 600;
    }

    .nav-row {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 16px;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 8px 18px;
      font-size: 14px;
      cursor: pointer;
      transition: opacity 0.1s ease, transform 0.05s ease, box-shadow 0.1s ease;
      font-weight: 700;
    }
    .btn:active {
      transform: translateY(1px);
      box-shadow: inset 0 2px 3px rgba(0,0,0,0.15);
    }
    .btn-primary {
      background: #ff7aa2;
      color: #fff;
    }
    .btn-secondary {
      background: #eee;
      color: #333;
    }
    .btn[disabled] {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }

    .log-group {
      border-top: 1px dashed #ddd;
      padding-top: 10px;
      margin-top: 10px;
    }
    .log-group:first-of-type {
      border-top: none;
      padding-top: 0;
      margin-top: 0;
    }
    .log-title {
      font-size: 14px;
      font-weight: 800;
      margin-bottom: 4px;
    }
    .log-selected {
      font-size: 13px;
      color: #444;
      margin-bottom: 4px;
      font-weight: 500;
    }
    .log-buttons {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }
    .log-btn {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #ccc;
      background: #fafafa;
      font-size: 13px;
      cursor: pointer;
      transition: background 0.1s ease, border-color 0.1s ease, transform 0.05s ease;
      font-weight: 700;
    }
    .log-btn:hover {
      background: #fff;
    }
    .log-btn.selected {
      border-color: #ff7aa2;
      background: #ffe4ef;
      transform: translateY(-1px);
    }

    .summary-box {
      background: #fff9fb;
      border-radius: 12px;
      padding: 12px;
      border: 1px solid #ffd0e0;
      font-size: 13px;
      margin-top: 8px;
      font-weight: 500;
    }
    .chips-row {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 6px;
    }
    .chip {
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #ffd0e0;
      background: #fff;
      font-weight: 600;
      color: #444;
    }

    .small-note {
      font-size: 11px;
      color: #777;
      margin-top: 6px;
    }

    /* Ëä±ÁÅ´„Ç®„Éï„Çß„ÇØ„Éà */
    #fireworks-container {
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
      z-index: 999;
    }
    .firework-dot {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: radial-gradient(circle, #fff, #ff7aa2);
      opacity: 0;
      animation: firework-pop 700ms ease-out forwards;
    }
    @keyframes firework-pop {
      0% {
        transform: translate(0, 0) scale(0.2);
        opacity: 0;
      }
      30% {
        opacity: 1;
      }
      100% {
        transform: translate(var(--tx), var(--ty)) scale(1);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <header class="app-header">
    <div class="app-header-left">
      <div class="app-header-title">„Åä‰∏ñË©±ÂêàÊà¶</div>
      <div class="app-header-sub">ÊØéÊó•„ÅÆ„Å°„ÅÑ„Åï„Å™„Åä‰∏ñË©±„Ç≤„Éº„É†</div>
    </div>
    <div class="app-header-right">
      <div>1Êó•„ÅÆ„Éü„Éã„Ç≤„Éº„É†</div>
      <div class="heart-box">
        <span>‚ù§Ô∏è</span>
        <span id="heart-count">0</span>
      </div>
    </div>
  </header>

  <div id="app">
    <!-- Â§ß„Åç„ÅÑ„Ç≠„É£„É©Ë°®Á§∫Ôºà„Ç≤„Éº„É†ÁîªÈù¢Áî®Ôºâ -->
    <div id="char-visual" class="char-visual hidden">
      <div id="char-visual-inner" class="char-visual-inner">
        <img id="char-visual-img" src="" alt="„Ç≠„É£„É©" />
      </div>
      <div id="char-visual-name" class="char-visual-name"></div>
      <div id="char-visual-tag" class="char-visual-tag"></div>
    </div>

    <!-- „Çπ„Çø„Éº„ÉàÁîªÈù¢Ôºö„Ç≠„É£„É©„ÇØ„Çø„ÉºÈÅ∏Êäû -->
    <section id="screen-start" class="screen active">
      <h2>1. „Ç≠„É£„É©„Çí„Åà„Çâ„Å∂</h2>
      <p style="font-size:13px; color:#444; font-weight:600; margin-bottom:6px;">
        „Åç„Çá„ÅÜ„ÄÅ„Å©„Çì„Å™„Åä‰∏ñË©±„Çí„Åå„Çì„Å∞„Çä„Åü„ÅÑÔºü
      </p>

      <div class="bubble" id="start-bubble">
        „Å†„Çå„Å®‰∏ÄÊó•„Åô„Åî„ÅôÔºü
      </div>

      <div class="char-list" id="char-list">
        <!-- JS„ÅßËøΩÂä† -->
      </div>

      <div class="nav-row">
        <button id="btn-start-next" class="btn btn-primary" disabled>„Åì„ÅÆ„Ç≠„É£„É©„Å´„Åô„Çã</button>
      </div>
    </section>

    <!-- „Ç∑„Éº„É≥ÁîªÈù¢Ôºö5„Ç∑„Éº„É≥ √ó 2ÊäûÔºàÔºù10ÂÄã„ÅÆ„Åä‰∏ñË©±Ôºâ -->
    <section id="screen-scenes" class="screen">
      <div class="scene-header">
        <div>
          <div class="scene-step" id="scene-step-label">„Ç∑„Éº„É≥ 1 / 5</div>
          <div class="scene-title" id="scene-title"></div>
        </div>
      </div>

      <div class="bubble" id="scene-bubble"></div>

      <div class="scene-desc" id="scene-desc"></div>

      <ul class="choice-list" id="choice-list">
        <!-- JS„ÅßÈÅ∏ÊäûËÇ¢„ÇíËøΩÂä† -->
      </ul>

      <div class="nav-row">
        <button id="btn-scene-back" class="btn btn-secondary">„ÇÇ„Å©„Çã</button>
        <button id="btn-scene-next" class="btn btn-primary" disabled>„Å§„Åé„Å∏</button>
      </div>
    </section>

    <!-- „É≠„Ç∞ÁîªÈù¢Ôºö„Åß„Åç„Åü„Åã„Å©„ÅÜ„Åã„ÅÆË®òÈå≤ -->
    <section id="screen-log" class="screen">
      <h2>2. „Åç„Çá„ÅÜ„ÅÆ„Åµ„Çä„Åã„Åà„Çä</h2>
      <p style="font-size:13px; color:#444; font-weight:600; margin-bottom:6px;">
        „Åß„Åç„Åü„Åã„Å©„ÅÜ„Åã„ÄÅ„Åà„Çâ„Çì„Åß„Å≠„ÄÇ
      </p>

      <div class="bubble" id="log-bubble">
        „Åç„Çá„ÅÜ„ÅÆ„Çà„ÅÜ„Åô„ÄÅÊïô„Åà„Å¶„Äú„ÄÇ
      </div>

      <div id="log-groups">
        <!-- JS„Åß5„Ç∑„Éº„É≥ÂàÜ„Çí„Å§„Åè„Çã -->
      </div>

      <div class="nav-row">
        <button id="btn-log-back" class="btn btn-secondary">„Ç∑„Éº„É≥„Å´„ÇÇ„Å©„Çã</button>
        <button id="btn-log-finish" class="btn btn-primary" disabled>ÁµêÊûú„ÇíË¶ã„Çã</button>
      </div>
    </section>

    <!-- ÁµêÊûúÁîªÈù¢ -->
    <section id="screen-summary" class="screen">
      <h2>3. „Åç„Çá„ÅÜ„ÅÆ„É¨„Éù„Éº„Éà</h2>

      <div class="bubble" id="summary-bubble">
        „Åç„Çá„ÅÜ„ÅÆ„Åä‰∏ñË©±„ÄÅ„Åä„Å§„Åã„Çå„Åï„Åæ„ÄÇ
      </div>

      <div class="summary-box" id="summary-main">
        <!-- JS„ÅßÈõÜË®à„ÇíË°®Á§∫ -->
      </div>

      <div class="chips-row" id="summary-tags">
        <!-- JS„Åß„Çø„Ç∞„Å£„ÅΩ„ÅèË°®Á§∫ -->
      </div>

      <p class="small-note">
        „Åß„Åç„Å™„Åã„Å£„ÅüÊó•„ÇÇ„ÄÅ„Äå„ÇÑ„Çç„ÅÜ„Å®ÊÄù„Å£„Åü„Äç„Å†„Åë„Åß„Åò„ÇÖ„ÅÜ„Å∂„Çì„Åà„Çâ„ÅÑ„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„Çì„Å≠„ÄÇ
      </p>

      <div class="nav-row">
        <button id="btn-summary-restart" class="btn btn-secondary">„ÇÇ„ÅÜ‰∏ÄÂõû„ÅÇ„Åù„Å∂</button>
      </div>
    </section>
  </div>

  <!-- Ëä±ÁÅ´„Ç≥„É≥„ÉÜ„Éä -->
  <div id="fireworks-container"></div>

  <script>
    // 3Ëâ≤„Ç≠„É£„É©Ôºà„Éî„É≥„ÇØ„Éª„Éñ„É´„Éº„Éª„Ç∞„É™„Éº„É≥Ôºâ
    const characters = [
      {
        id: "pink",
        name: "„Éî„É≥„ÇØ„Çø„Ç§„Éó",
        description: "„Åä„Åó„ÇÉ„Çå„Å®Ê∞óÂàÜ„Ç¢„Ç≤ÊãÖÂΩì„ÄÇ",
        image: "public/char/pinkjoy.png",
        tag: "„Åò„Å∂„Çì„Çâ„Åó„Åï",
        themeColor: "#ff9ecb"
      },
      {
        id: "blue",
        name: "„Éñ„É´„Éº„Çø„Ç§„Éó",
        description: "„Åî„ÅØ„Çì„Å®‰ºë„Åë„ÅÑÊãÖÂΩì„ÄÇ",
        image: "public/char/bluejoy.png",
        tag: "„Åî„Åª„ÅÜ„Å≥„Çø„Ç§„É†",
        themeColor: "#8ec5ff"
      },
      {
        id: "green",
        name: "„Ç∞„É™„Éº„É≥„Çø„Ç§„Éó",
        description: "„Å≠„ÇÄ„Çä„Å®„Åã„Çâ„Å†ÊãÖÂΩì„ÄÇ",
        image: "public/char/greenjoy.png",
        tag: "„Åã„Çâ„Å†„Ç±„Ç¢",
        themeColor: "#9fe8a6"
      }
    ];

    // ÂêÑ„Ç≠„É£„É©Ôºö1Êó•10ÂÄã„ÅÆ„Åä‰∏ñË©±Ôºà5„Ç∑„Éº„É≥√ó2ÊäûÔºâ
    // „Ç¢„ÇØ„Çª„Çµ„É™„Éº„ÉªÂ∞èÁâ©Á≥ª„ÅØ„Ç¢„Ç§„Ç≥„É≥„Å§„ÅçÔºàiconEmojiÔºâ
    const scenesByChar = {
      pink: [
        {
          id: "p_morning1",
          title: "ÊúùÔºöËµ∑„Åç„Åü„Å®„Åç",
          desc: "ÁõÆ„Åå„Åï„ÇÅ„Åü„Å®„Åç„ÄÅ„Åæ„Åö„Å©„Å£„Å°Ôºü",
          choices: [
            {
              id: "p_m1_smile",
              label: "„Åµ„Å®„Çì„ÅÆ‰∏≠„Åß„ÄÅ„Éã„Ç≥„ÉÉ„Å®1Âõû„Çè„Çâ„ÅÜ",
              tag: "„ÅÇ„Åï„Éã„Ç≥„ÉÉ",
              iconEmoji: "üòä"
            },
            {
              id: "p_m1_breath",
              label: "Ê∑±ÂëºÂê∏„Çí3Âõû„Åó„Å¶„Åã„ÇâËµ∑„Åç„ÅÇ„Åå„Çã",
              tag: "„ÅÇ„Åï„ÅÆÊ∑±ÂëºÂê∏",
              iconEmoji: "üå¨Ô∏è"
            }
          ]
        },
        {
          id: "p_morning2",
          title: "ÊúùÔºöÂá∫„Åã„Åë„ÇãÊ∫ñÂÇô",
          desc: "Âá∫„Åã„Åë„ÇãÂâç„Å´„ÄÅ„Åò„Å∂„Çì„Å´„Å©„Çì„Å™„Åä‰∏ñË©±Ôºü",
          choices: [
            {
              id: "p_m2_accessory",
              label: "„Ç¢„ÇØ„Çª„ÉªÂ∞èÁâ©„Çí1„Å§„Åà„Çâ„Å∂Ôºà„Éò„Ç¢„Éî„É≥„Éª„Ç§„É§„Éõ„É≥„Å™„Å©Ôºâ",
              tag: "Â∞èÁâ©„Çí„Åà„Çâ„Å∂",
              iconEmoji: "üéÄ"
            },
            {
              id: "p_m2_mirror",
              label: "Èè°„ÇíË¶ã„Å¶„Äå„Åç„Çá„ÅÜ„ÇÇ„ÅÑ„Åë„Çã„Äç„Å®Â∞èÂ£∞„ÅßË®Ä„ÅÜ",
              tag: "„Åò„Å∂„Çì„Ç®„Éº„É´",
              iconEmoji: "ü™û"
            }
          ]
        },
        {
          id: "p_school",
          title: "Â≠¶Ê†°Ôºö‰ºë„ÅøÊôÇÈñì",
          desc: "„Å°„Çá„Å£„Å®Á©∫„ÅÑ„ÅüÊôÇÈñì„Å´„ÄÅ„Å©„Å£„Å°Ôºü",
          choices: [
            {
              id: "p_s_doodle",
              label: "„Éé„Éº„Éà„ÅÆ„Åô„Åø„Å´„ÄÅ„Çâ„Åè„Åå„Åç„Çí1„Å§„Åã„Åè",
              tag: "„Çâ„Åè„Åå„Åç",
              iconEmoji: "‚úèÔ∏è"
            },
            {
              id: "p_s_sticker",
              label: "„Çπ„Ç±„Ç∏„É•„Éº„É´Â∏≥„ÇÑ„Éé„Éº„Éà„Å´„Ç∑„Éº„É´„ÇÑ„Éû„Éº„ÇØ„Çí1„Å§„Å§„Åë„Çã",
              tag: "„Éû„Éº„ÇØ1„Åì",
              iconEmoji: "‚≠ê"
            }
          ]
        },
        {
          id: "p_afternoon",
          title: "ÊîæË™≤ÂæåÔºöÂÆ∂„Å´„Å§„ÅÑ„Åü„ÅÇ„Å®",
          desc: "ÂÆ∂„Å´Â∏∞„Å£„Å¶„Åã„Çâ„ÅÆ„Åò„Å∂„Çì„ÅÆ„Åä‰∏ñË©±„ÅØÔºü",
          choices: [
            {
              id: "p_a_desk",
              label: "Êú∫„ÅÆ‰∏ä„Çí1ÂàÜ„Å†„Åë„Å®„Å®„ÅÆ„Åà„Çã",
              tag: "Êú∫„É™„Çª„ÉÉ„Éà",
              iconEmoji: "üßπ"
            },
            {
              id: "p_a_music",
              label: "„Åô„Åç„Å™Êõ≤„Çí1Êõ≤„Å†„ÅëÊµÅ„Åó„Å¶„Åç„Åè",
              tag: "1Êõ≤„Çø„Ç§„É†",
              iconEmoji: "üéß"
            }
          ]
        },
        {
          id: "p_night",
          title: "Â§úÔºö„Å≠„ÇãÂâç",
          desc: "„ÅÇ„Åó„Åü„ÅÆ„Åò„Å∂„Çì„ÅÆ„Åü„ÇÅ„Å´„ÄÅ„Å©„Å£„Å°Ôºü",
          choices: [
            {
              id: "p_n_color",
              label: "„ÅÇ„Åó„Åü„ÅÆÊúç„ÅÆ„ÄåËâ≤„Äç„Å†„ÅëÂÖà„Å´Ê±∫„ÇÅ„Çã",
              tag: "„ÅÇ„Åó„Åü„ÅÆ„Ç´„É©„Éº",
              iconEmoji: "üé®"
            },
            {
              id: "p_n_good",
              label: "„Åç„Çá„ÅÜ„ÅÆ„Äå„Çà„Åã„Å£„Åü„Åì„Å®„Äç„Çí1Ë°å„É°„É¢„Çã",
              tag: "„Çà„Åã„Å£„Åü1Ë°å",
              iconEmoji: "üìù"
            }
          ]
        }
      ],
      blue: [
        {
          id: "b_morning1",
          title: "ÊúùÔºöËµ∑„Åç„Åü„Å®„Åç",
          desc: "„Åä„Å™„Åã„Å®ÂøÉ„Å∏„ÅÆÊúÄÂàù„ÅÆ„Åä‰∏ñË©±„ÅØÔºü",
          choices: [
            {
              id: "b_m1_water",
              label: "Ëµ∑„Åç„Åü„ÇâÊ∞¥„Çí1ÊùØ„ÅÆ„ÇÄ",
              tag: "„ÅÇ„Åï„Åø„Åö",
              iconEmoji: "üíß"
            },
            {
              id: "b_m1_bite",
              label: "„Å≤„Å®Âè£„Å†„Åë„Åß„ÇÇ„Åî„ÅØ„Çì„Åã„Éë„É≥„ÇíÈ£ü„Åπ„Çã",
              tag: "„Å≤„Å®Âè£„É¢„Ç∞",
              iconEmoji: "üçû"
            }
          ]
        },
        {
          id: "b_morning2",
          title: "ÊúùÔºöÂá∫„Åã„Åë„ÇãÂâç",
          desc: "Â§ñ„Å´Âá∫„ÇãÂâç„Å´„Å©„Å£„Å°Ôºü",
          choices: [
            {
              id: "b_m2_snack_check",
              label: "„Ç´„Éê„É≥„Å´‰ªäÊó•„ÅÆÂ∞è„Åï„Å™„Åä„ÇÑ„Å§„Çí1„Å§ÂÖ•„Çå„Çã",
              tag: "„Åä„ÇÑ„Å§„ÉÅ„Çß„ÉÉ„ÇØ",
              iconEmoji: "üç™"
            },
            {
              id: "b_m2_bottle",
              label: "Ê∞¥Á≠í„Åã„Éö„ÉÉ„Éà„Éú„Éà„É´„Çí„Ç´„Éê„É≥„Å´ÂÖ•„Çå„Çã",
              tag: "Ê∞¥„Å®„ÅÜ„Åò„ÇÖ„Çì„Å≥",
              iconEmoji: "ü•§"
            }
          ]
        },
        {
          id: "b_school",
          title: "Â≠¶Ê†°Ôºö‰ºë„ÅøÊôÇÈñì",
          desc: "‰ºë„ÅøÊôÇÈñì„ÅÆ„Å≤„Å®ÊÅØ„Çø„Ç§„É†„ÅØÔºü",
          choices: [
            {
              id: "b_s_sip",
              label: "È£≤„ÅøÁâ©„Çí3Âè£„Å†„Åë„ÇÜ„Å£„Åè„Çä„ÅÆ„ÇÄ",
              tag: "3Âè£„Åî„Åè„Åî„Åè",
              iconEmoji: "ü´ó"
            },
            {
              id: "b_s_snack",
              label: "„Åä„ÇÑ„Å§„Çí1„Å§„Åà„Çâ„Çì„Åß„ÄÅ„Çà„ÅèÂë≥„Çè„ÅÜ",
              tag: "„Åî„Åª„ÅÜ„Å≥„Åä„ÇÑ„Å§",
              iconEmoji: "üç¨"
            }
          ]
        },
        {
          id: "b_afternoon",
          title: "ÊîæË™≤ÂæåÔºöÂÆ∂„Å´„Å§„ÅÑ„Åü„ÅÇ„Å®",
          desc: "„Å§„Åã„Çå„Åü„ÅÇ„Å®„ÄÅ„Å©„Å£„Å°„Åß‰ºë„Åë„ÅÑÔºü",
          choices: [
            {
              id: "b_a_hotdrink",
              label: "„ÅÇ„Åü„Åü„Åã„ÅÑÈ£≤„ÅøÁâ©„Çí‰Ωú„Å£„Å¶3ÂàÜ‰ºë„Åë„ÅÑ",
              tag: "„Éõ„ÉÉ„Éà„Éâ„É™„É≥„ÇØ",
              iconEmoji: "‚òï"
            },
            {
              id: "b_a_cold",
              label: "„Å§„ÇÅ„Åü„ÅÑÊ∞¥„Çí„Ç≥„ÉÉ„Éó1ÊùØ„ÅÆ„Çì„Åß„É™„Éï„É¨„ÉÉ„Ç∑„É•",
              tag: "„Å§„ÇÅ„Åü„ÅÑ‰∏ÄÊùØ",
              iconEmoji: "üßä"
            }
          ]
        },
        {
          id: "b_night",
          title: "Â§úÔºö„Å≠„ÇãÂâç",
          desc: "„ÅÇ„Åó„Åü„ÅÆÈ£ü„ÅÆ„Åä‰∏ñË©±„ÅØ„Å©„Å£„Å°Ôºü",
          choices: [
            {
              id: "b_n_breakfast",
              label: "„ÅÇ„Åó„ÅüÈ£ü„Åπ„Åü„ÅÑÊúù„Åî„ÅØ„Çì„Çí1Ë°å„É°„É¢„Çã",
              tag: "„ÅÇ„Åï„Åî„ÅØ„Çì„É°„É¢",
              iconEmoji: "üçô"
            },
            {
              id: "b_n_dish",
              label: "„ÅÇ„Åó„Åü‰Ωø„ÅÜ„ÅäÂºÅÂΩìÁÆ±„ÇÑ„ÅäÁöø„Çí„ÉÜ„Éº„Éñ„É´„ÅÆ‰∏ä„Å´Âá∫„Åó„Å¶„Åä„Åè",
              tag: "„ÅÜ„Å§„Çè„Åò„ÇÖ„Çì„Å≥",
              iconEmoji: "üçΩÔ∏è"
            }
          ]
        }
      ],
      green: [
        {
          id: "g_morning1",
          title: "ÊúùÔºöËµ∑„Åç„Åü„Å®„Åç",
          desc: "„Å≠„Åº„Åë„Åü„Åã„Çâ„Å†„Å´„Å©„Å£„Å°Ôºü",
          choices: [
            {
              id: "g_m1_stretch",
              label: "„Åµ„Å®„Çì„ÅÆ‰∏ä„ÅßÊâãË∂≥„Çí„Åê„Éº„Å£„Å®‰º∏„Å∞„Åô",
              tag: "„ÅÆ„Å≥„ÅÆ„Å≥",
              iconEmoji: "üßò"
            },
            {
              id: "g_m1_ankle",
              label: "Ë∂≥È¶ñ„Çí„Åê„Çã„Åê„Çã10Âõû„Åæ„Çè„Åô",
              tag: "„ÅÇ„Åó„Åè„Å≥„Åê„Çã„Åê„Çã",
              iconEmoji: "ü¶∂"
            }
          ]
        },
        {
          id: "g_morning2",
          title: "ÊúùÔºöÂá∫„Åã„Åë„ÇãÊ∫ñÂÇô",
          desc: "Âá∫„Åã„Åë„ÇãÂâç„ÄÅ„Åã„Çâ„Å†„Å´„Å©„Å£„Å°Ôºü",
          choices: [
            {
              id: "g_m2_posture",
              label: "Âá∫„Åã„Åë„ÇãÂâç„Å´ËÉå„Åô„Åò„Çí„Éî„Éº„É≥„Å®30Áßí„Åü„Å¶„Çã",
              tag: "„Åõ„Åô„Åò„Éî„Éº„É≥",
              iconEmoji: "üßç"
            },
            {
              id: "g_m2_water",
              label: "Ê∞¥„Åã„ÅäËå∂„Çí1ÊùØ„ÅÆ„Çì„Åß„Åã„ÇâÂÆ∂„ÇíÂá∫„Çã",
              tag: "Ê∞¥ÂàÜ„ÉÅ„É£„Éº„Ç∏",
              iconEmoji: "ü•§"
            }
          ]
        },
        {
          id: "g_school",
          title: "Â≠¶Ê†°Ôºö‰ºë„ÅøÊôÇÈñì",
          desc: "‰ºë„ÅøÊôÇÈñì„ÅÆ„Åã„Çâ„Å†„Ç±„Ç¢„ÅØÔºü",
          choices: [
            {
              id: "g_s_shoulder",
              label: "ËÇ©„ÇíÂâçÂæå„Å´10Âõû„Åæ„Çè„Åô",
              tag: "„Åã„Åü„Ç∞„É´„Ç∞„É´",
              iconEmoji: "üí™"
            },
            {
              id: "g_s_eyes",
              label: "ÈÅ†„Åè„ÇíË¶ã„ÇãÔºãÁõÆ„Çí„ÇÆ„É•„ÉÉ„Å®„Å§„Å∂„Çã„Çí3Âõû„Åè„ÇäËøî„Åô",
              tag: "„ÇÅ„Ç±„Ç¢",
              iconEmoji: "üëÄ"
            }
          ]
        },
        {
          id: "g_afternoon",
          title: "ÊîæË™≤ÂæåÔºöÂÆ∂„Å´„Å§„ÅÑ„Åü„ÅÇ„Å®",
          desc: "„Å§„Åã„Çå„Åü„Åã„Çâ„Å†„Å´„Å©„Å£„Å°Ôºü",
          choices: [
            {
              id: "g_a_walk",
              label: "ÂÆ∂„ÅÆ„Åæ„Çè„Çä„Çí3„Äú5ÂàÜ„Å†„ÅëÊ≠©„Åè",
              tag: "„Å°„Çá„ÅÑÊ≠©„Åç",
              iconEmoji: "üö∂"
            },
            {
              id: "g_a_leg",
              label: "„Åµ„Åè„Çâ„ÅØ„Åé„ÇíËªΩ„Åè„ÇÇ„Åø„Åª„Åê„Åô",
              tag: "„ÅÇ„Åó„Ç±„Ç¢",
              iconEmoji: "ü¶µ"
            }
          ]
        },
        {
          id: "g_night",
          title: "Â§úÔºö„Å≠„ÇãÂâç",
          desc: "„Å≠„ÇÄ„Çä„ÅÆ„Åä‰∏ñË©±„ÅØ„Å©„Å£„Å°Ôºü",
          choices: [
            {
              id: "g_n_screen",
              label: "„Å≠„Çã5ÂàÜÂâç„Å´ÁîªÈù¢„Çí„Å®„Åò„Å¶ÁõÆ„Çí„Å®„Åò„Çã",
              tag: "ÁîªÈù¢„Åä„ÇÑ„Åô„Åø",
              iconEmoji: "üìµ"
            },
            {
              id: "g_n_breath",
              label: "Ê∑±ÂëºÂê∏„Çí3Âõû„Åó„Å¶„Åã„ÇâÂ∏ÉÂõ£„Å´ÂÖ•„Çã",
              tag: "„Å≠„ÇãÂâçÂëºÂê∏",
              iconEmoji: "üåô"
            }
          ]
        }
      ]
    };

    // Áä∂ÊÖãÁÆ°ÁêÜ
    const state = {
      characterId: null,
      selections: {}, // sceneId -> choiceId
      results: {},    // sceneId -> "did" | "half" | "no"
      heart: 0
    };

    // ‰ªäÈÅ∏„Å∞„Çå„Å¶„ÅÑ„Çã„Ç≠„É£„É©Áî®„ÅÆ„Ç∑„Éº„É≥„Çª„ÉÉ„Éà
    let currentScenes = [];

    // DOM Ë¶ÅÁ¥†
    const screenStart   = document.getElementById("screen-start");
    const screenScenes  = document.getElementById("screen-scenes");
    const screenLog     = document.getElementById("screen-log");
    const screenSummary = document.getElementById("screen-summary");

    const charListEl = document.getElementById("char-list");
    const btnStartNext = document.getElementById("btn-start-next");

    const sceneStepLabel = document.getElementById("scene-step-label");
    const sceneTitle = document.getElementById("scene-title");
    const sceneDesc = document.getElementById("scene-desc");
    const choiceListEl = document.getElementById("choice-list");
    const sceneBubble = document.getElementById("scene-bubble");

    const btnSceneBack = document.getElementById("btn-scene-back");
    const btnSceneNext = document.getElementById("btn-scene-next");

    const logGroupsEl = document.getElementById("log-groups");
    const btnLogBack = document.getElementById("btn-log-back");
    const btnLogFinish = document.getElementById("btn-log-finish");

    const summaryMain = document.getElementById("summary-main");
    const summaryTags = document.getElementById("summary-tags");
    const summaryBubble = document.getElementById("summary-bubble");

    const heartCountEl = document.getElementById("heart-count");

    const charVisual = document.getElementById("char-visual");
    const charVisualInner = document.getElementById("char-visual-inner");
    const charVisualImg = document.getElementById("char-visual-img");
    const charVisualName = document.getElementById("char-visual-name");
    const charVisualTag = document.getElementById("char-visual-tag");

    const fireworksContainer = document.getElementById("fireworks-container");

    let currentSceneIndex = 0;

    function showScreen(screen) {
      [screenStart, screenScenes, screenLog, screenSummary].forEach(s => {
        s.classList.remove("active");
      });
      screen.classList.add("active");

      // „Ç≠„É£„É©„Éì„Ç∏„É•„Ç¢„É´„ÅÆË°®Á§∫ÔºèÈùûË°®Á§∫
      if (screen === screenStart || !state.characterId) {
        charVisual.classList.add("hidden");
      } else {
        charVisual.classList.remove("hidden");
      }
    }

    function updateHeartView() {
      heartCountEl.textContent = state.heart;
    }

    function getActiveCharacter() {
      return characters.find(c => c.id === state.characterId);
    }

    function updateCharVisual() {
      const char = getActiveCharacter();
      if (!char) return;
      charVisualImg.src = char.image;
      charVisualImg.alt = char.name;
      charVisualName.textContent = char.name;
      charVisualTag.textContent = char.tag;
      charVisualInner.style.background =
        `radial-gradient(circle at 30% 20%, #fff, ${char.themeColor})`;
    }

    function spinCharacterOnce() {
      charVisualInner.classList.remove("spin-kuru");
      requestAnimationFrame(() => {
        charVisualInner.classList.add("spin-kuru");
        setTimeout(() => {
          charVisualInner.classList.remove("spin-kuru");
        }, 700);
      });
    }

    // Ëä±ÁÅ´„Ç®„Éï„Çß„ÇØ„Éà
    function triggerFireworks(x, y) {
      const rect = document.body.getBoundingClientRect();
      const centerX = x || rect.width / 2;
      const centerY = y || rect.height / 2;

      for (let i = 0; i < 12; i++) {
        const dot = document.createElement("div");
        dot.className = "firework-dot";

        const angle = (Math.PI * 2 * i) / 12;
        const distance = 80 + Math.random() * 40;
        const tx = Math.cos(angle) * distance;
        const ty = Math.sin(angle) * distance;

        dot.style.left = centerX + "px";
        dot.style.top = centerY + "px";
        dot.style.setProperty("--tx", tx + "px");
        dot.style.setProperty("--ty", ty + "px");

        fireworksContainer.appendChild(dot);

        setTimeout(() => {
          fireworksContainer.removeChild(dot);
        }, 800);
      }
    }

    // „Ç≠„É£„É©„Ç´„Éº„ÉâË°®Á§∫
    function renderCharacterCards() {
      charListEl.innerHTML = "";
      characters.forEach(char => {
        const card = document.createElement("div");
        card.className = "char-card";
        card.dataset.charId = char.id;

        const icon = document.createElement("div");
        icon.className = "char-icon-small";
        if (char.image) {
          const img = document.createElement("img");
          img.src = char.image;
          img.alt = char.name;
          icon.appendChild(img);
        } else {
          icon.textContent = "‚≠ê";
        }

        const infoDiv = document.createElement("div");
        const title = document.createElement("div");
        title.className = "char-info-title";
        title.textContent = char.name;

        const desc = document.createElement("div");
        desc.className = "char-info-desc";
        desc.textContent = char.description;

        const tag = document.createElement("div");
        tag.className = "char-info-tag";
        tag.textContent = char.tag;

        infoDiv.appendChild(title);
        infoDiv.appendChild(desc);
        infoDiv.appendChild(tag);

        card.appendChild(icon);
        card.appendChild(infoDiv);

        card.addEventListener("click", () => {
          state.characterId = char.id;
          document.querySelectorAll(".char-card").forEach(c => c.classList.remove("selected"));
          card.classList.add("selected");
          btnStartNext.disabled = false;

          const bubble = document.getElementById("start-bubble");
          bubble.textContent = char.name + "Ôºö„Äå" + char.tag + " „Çí„ÅÑ„Å£„Åó„Çá„Å´„ÇÑ„Çç„ÅÜÔºÅ„Äç";
        });

        charListEl.appendChild(card);
      });
    }

    // „Ç∑„Éº„É≥Ë°®Á§∫Ôºà2Êäû√ó5„Ç∑„Éº„É≥Ôºâ
    function renderScene() {
      if (!currentScenes || currentScenes.length === 0) return;
      const scene = currentScenes[currentSceneIndex];
      const char = getActiveCharacter();
      if (char) {
        updateCharVisual();
      }

      sceneStepLabel.textContent = `„Ç∑„Éº„É≥ ${currentSceneIndex + 1} / ${currentScenes.length}`;
      sceneTitle.textContent = scene.title;
      sceneDesc.textContent = scene.desc;

      const sceneMessages = [
        "„Å©„Å£„Å°„Åã„Çâ„ÅØ„Åò„ÇÅ„ÇãÔºü",
        "„Å§„Åé„ÅÆ„Åä‰∏ñË©±„ÅØ„Å©„Å£„Å°Ôºü",
        "„Åæ„Å†„ÅÇ„Å®Â∞ë„Åó„ÄÅ„Å©„Å£„Å°„Å´„Åô„ÇãÔºü",
        "„ÅÇ„Å®Â∞ë„Åó„Å†„Åë„Åä‰∏ñË©±„Çø„Ç§„É†„ÄÇ",
        "„Åï„ÅÑ„Åî„ÅÆ1„Åì„ÄÅ„Å©„Å£„Å°„Å´„Åô„ÇãÔºü"
      ];
      const msg = sceneMessages[currentSceneIndex] || "„Å©„Å£„Å°„Å´„Åô„ÇãÔºü";
      sceneBubble.textContent = (char ? char.name + "Ôºö " : "") + msg;

      choiceListEl.innerHTML = "";
      const selectedChoiceId = state.selections[scene.id];

      scene.choices.forEach(ch => {
        const li = document.createElement("li");
        li.className = "choice-item";

        const input = document.createElement("input");
        input.type = "radio";
        input.name = "choice-" + scene.id;
        input.value = ch.id;
        input.checked = ch.id === selectedChoiceId;

        const iconDiv = document.createElement("div");
        iconDiv.className = "choice-icon-circle";
        iconDiv.textContent = ch.iconEmoji || "Ôºä";

        const mainDiv = document.createElement("div");
        mainDiv.className = "choice-main";

        const labelDiv = document.createElement("div");
        labelDiv.className = "choice-label";
        labelDiv.textContent = ch.label;

        const tagDiv = document.createElement("div");
        tagDiv.className = "choice-tag";
        tagDiv.textContent = "‰ªäÊó•„ÅÆ„Åä‰∏ñË©±Ôºö" + ch.tag;

        mainDiv.appendChild(labelDiv);
        mainDiv.appendChild(tagDiv);

        li.appendChild(iconDiv);
        li.appendChild(input);
        li.appendChild(mainDiv);

        const selectHandler = (event) => {
          input.checked = true;
          state.selections[scene.id] = ch.id;
          updateSceneNextButton();

          // Ëä±ÁÅ´ÔºöÈÅ∏„Çì„Å†„Å®„Åç„Å´„Å±„Éº„Çì
          const rect = li.getBoundingClientRect();
          const x = rect.left + rect.width / 2;
          const y = rect.top + rect.height / 2;
          triggerFireworks(x, y);
        };

        li.addEventListener("click", selectHandler);
        input.addEventListener("change", selectHandler);

        choiceListEl.appendChild(li);
      });

      updateSceneNextButton();
      btnSceneBack.disabled = currentSceneIndex === 0;
    }

    function updateSceneNextButton() {
      if (!currentScenes || currentScenes.length === 0) return;
      const scene = currentScenes[currentSceneIndex];
      btnSceneNext.disabled = !state.selections[scene.id];
      btnSceneNext.textContent =
        currentSceneIndex === currentScenes.length - 1 ? "„Åµ„Çä„Åã„Åà„Çä„Å∏" : "„Å§„Åé„ÅÆ„Ç∑„Éº„É≥„Å∏";
    }

    // „É≠„Ç∞ÁîªÈù¢ÊèèÁîª
    function renderLogScreen() {
      const char = getActiveCharacter();
      if (char) {
        updateCharVisual();
        document.getElementById("log-bubble").textContent =
          char.name + "Ôºö „Å©„Çå„Åè„Çâ„ÅÑ„Åß„Åç„ÅüÔºü";
      }

      logGroupsEl.innerHTML = "";

      currentScenes.forEach(scene => {
        const choiceId = state.selections[scene.id];
        const choice = scene.choices.find(c => c.id === choiceId);

        const groupDiv = document.createElement("div");
        groupDiv.className = "log-group";

        const titleDiv = document.createElement("div");
        titleDiv.className = "log-title";
        titleDiv.textContent = scene.title;

        const selectedDiv = document.createElement("div");
        selectedDiv.className = "log-selected";
        selectedDiv.textContent = choice
          ? "„Åç„ÇÅ„Åü„Åä‰∏ñË©±Ôºö " + choice.label
          : "„Åæ„Å†„Åà„Çâ„Å∞„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ";

        const buttonsDiv = document.createElement("div");
        buttonsDiv.className = "log-buttons";

        const levels = [
          { id: "did",  label: "„Åß„Åç„ÅüÔºÅ" },
          { id: "half", label: "ÂçäÂàÜ„Åß„Åç„Åü" },
          { id: "no",   label: "„Åß„Åç„Å™„Åã„Å£„Åü" }
        ];

        levels.forEach(lv => {
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "log-btn";
          btn.textContent = lv.label;
          btn.dataset.level = lv.id;
          btn.dataset.sceneId = scene.id;

          const saved = state.results[scene.id];
          if (saved === lv.id) {
            btn.classList.add("selected");
          }

          btn.addEventListener("click", () => {
            state.results[scene.id] = lv.id;
            buttonsDiv.querySelectorAll(".log-btn").forEach(b => {
              b.classList.toggle("selected", b.dataset.level === lv.id);
            });
            updateLogFinishButton();
          });

          buttonsDiv.appendChild(btn);
        });

        groupDiv.appendChild(titleDiv);
        groupDiv.appendChild(selectedDiv);
        groupDiv.appendChild(buttonsDiv);

        logGroupsEl.appendChild(groupDiv);
      });

      updateLogFinishButton();
    }

    function updateLogFinishButton() {
      const allFilled = currentScenes.every(sc => state.results[sc.id]);
      btnLogFinish.disabled = !allFilled;
    }

    // ÁµêÊûúÁîªÈù¢ÊèèÁîª
    function renderSummary() {
      const char = getActiveCharacter();
      if (char) {
        updateCharVisual();
      }

      const totals = { did: 0, half: 0, no: 0 };

      currentScenes.forEach(scene => {
        const r = state.results[scene.id];
        if (r && totals[r] !== undefined) {
          totals[r] += 1;
        }
      });

      // „Éè„Éº„ÉàË®àÁÆóÔºö„Åß„Åç„Åü=2, ÂçäÂàÜ=1, „Åß„Åç„Å™„Åã„Å£„Åü=0
      let heartGain = 0;
      currentScenes.forEach(scene => {
        const r = state.results[scene.id];
        if (r === "did") heartGain += 2;
        if (r === "half") heartGain += 1;
      });
      state.heart += heartGain;
      updateHeartView();

      const messages = [];
      if (totals.did > 0) {
        messages.push(`„Äå„Åß„Åç„ÅüÔºÅ„ÄçÔºö${totals.did} ‰ª∂`);
      }
      if (totals.half > 0) {
        messages.push(`„ÄåÂçäÂàÜ„Åß„Åç„Åü„ÄçÔºö${totals.half} ‰ª∂`);
      }
      if (totals.no > 0) {
        messages.push(`„Äå„Åß„Åç„Å™„Åã„Å£„Åü„ÄçÔºö${totals.no} ‰ª∂`);
      }

      const mainTextLines = [];

      if (char) {
        mainTextLines.push(`${char.name} „Å®„Åô„Åî„Åó„Åü1Êó•„ÄÇ`);
      }

      if (messages.length > 0) {
        mainTextLines.push(messages.join(" Ôºè "));
      }

      if (heartGain > 0) {
        mainTextLines.push(`„Åç„Çá„ÅÜ„Åµ„Åà„Åü„Éè„Éº„ÉàÔºö+${heartGain}`);
      } else {
        mainTextLines.push("„Åç„Çá„ÅÜ„ÅØ„Éè„Éº„Éà„ÅØ„Åµ„Åà„Å™„Åã„Å£„ÅüÊó•„ÄÇ„Åù„Çì„Å™Êó•„ÇÇOK„ÄÇ");
      }

      summaryMain.innerHTML = "";
      mainTextLines.forEach(line => {
        const p = document.createElement("p");
        p.style.margin = "4px 0";
        p.textContent = line;
        summaryMain.appendChild(p);
      });

      // „Çø„Ç∞Ë°®Á§∫Ôºà„Åç„Çá„ÅÜÈÅ∏„Çì„Å†„Åä‰∏ñË©±Ôºâ
      summaryTags.innerHTML = "";
      const tagSet = new Set();

      currentScenes.forEach(scene => {
        const choiceId = state.selections[scene.id];
        const choice = scene.choices.find(c => c.id === choiceId);
        if (choice) {
          tagSet.add(choice.tag);
        }
      });

      Array.from(tagSet).forEach(tag => {
        const div = document.createElement("div");
        div.className = "chip";
        div.textContent = "„Åç„Çá„ÅÜ„ÅÆ„Åä‰∏ñË©±Ôºö" + tag;
        summaryTags.appendChild(div);
      });

      if (char) {
        let charComment = "";
        if (totals.did >= 3) {
          charComment = "„Çà„Åè„Åå„Çì„Å∞„Å£„Åü„Å≠„ÄÇ„Åã„Çâ„Å†„ÇÇÂøÉ„ÇÇ„Éã„Ç≥„Éã„Ç≥„Åã„ÇÇ„ÄÇ";
        } else if (totals.half >= 1) {
          charComment = "„ÄåÂçäÂàÜ„Åß„Åç„Åü„Äç„Å´Ê∞ó„Å•„Åë„Åü„ÅÆ„ÄÅ„Åô„Åî„Åè„ÅÑ„ÅÑ„Çà„ÄÇ";
        } else if (totals.no >= 1) {
          charComment = "„Åß„Åç„Å™„ÅÑÊó•„ÇÇÂ§ß‰∫ã„Å™1Êó•„ÄÇ„Åæ„Åü„ÅÇ„Åù„Åº„ÄÇ";
        } else {
          charComment = "„Å§„Åé„ÅØ„Å©„Çì„Å™1Êó•„Å´„Åó„Çà„ÅÜ„ÅãÔºü";
        }
        summaryBubble.textContent = char.name + "Ôºö " + charComment;
      }

      // ÊúÄÂæå„Å´„Ç≠„É£„É©„Åå„Åè„Çã„Çä„Çì
      spinCharacterOnce();
    }

    // „Ç§„Éô„É≥„ÉàË®≠ÂÆö
    document.addEventListener("DOMContentLoaded", () => {
      renderCharacterCards();
      updateHeartView();

      btnStartNext.addEventListener("click", () => {
        if (!state.characterId) return;
        // „Ç≠„É£„É©„Åî„Å®„ÅÆ„Ç∑„Éº„É≥„Çí„Çª„ÉÉ„ÉàÔºà1Êó•10ÂÄãÔºâ
        currentScenes = scenesByChar[state.characterId] || scenesByChar["pink"];
        currentSceneIndex = 0;
        state.selections = {};
        state.results = {};
        showScreen(screenScenes);
        updateCharVisual();
        renderScene();
      });

      btnSceneBack.addEventListener("click", () => {
        if (currentSceneIndex === 0) {
          showScreen(screenStart);
        } else {
          currentSceneIndex -= 1;
          renderScene();
        }
      });

      btnSceneNext.addEventListener("click", () => {
        if (currentSceneIndex < currentScenes.length - 1) {
          currentSceneIndex += 1;
          renderScene();
        } else {
          showScreen(screenLog);
          renderLogScreen();
        }
      });

      btnLogBack.addEventListener("click", () => {
        showScreen(screenScenes);
        renderScene();
      });

      btnLogFinish.addEventListener("click", () => {
        showScreen(screenSummary);
        renderSummary();
      });

      document.getElementById("btn-summary-restart").addEventListener("click", () => {
        // „Ç≠„É£„É©ÈÅ∏„Å≥„Åã„Çâ„ÇÑ„ÇäÁõ¥„ÅóÔºà„Éè„Éº„Éà„ÅØÁ©ç„Åø‰∏ä„Åí„ÅÆ„Åæ„ÅæÔºâ
        state.characterId = null;
        state.selections = {};
        state.results = {};
        currentScenes = [];
        currentSceneIndex = 0;
        btnStartNext.disabled = true;
        document.querySelectorAll(".char-card").forEach(c => c.classList.remove("selected"));
        document.getElementById("start-bubble").textContent = "„Å†„Çå„Å®‰∏ÄÊó•„Åô„Åî„ÅôÔºü";
        showScreen(screenStart);
      });
    });
  </script>
</body>
</html>
